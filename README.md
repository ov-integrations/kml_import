# kml_import

Downloads KMZ file from the specified location, extracts data to CSV file and loads it with the specified OneVizion import.

In the KMZ file must be only one KML file, if there is more than one, then the integration will end with an error.

The structure of the KML and CSV files should follow the examples below.

Requirements
- python 3
- python [OneVizion](https://github.com/Onevizion/API-v3) library (pip install onevizion)
- python [Requests](https://docs.python-requests.org/en/master/) library (pip install requests)
- python [BeautifulSoup](https://www.crummy.com/software/BeautifulSoup/bs4/doc/#installing-beautiful-soup) library (pip install beautifulsoup4)
- python [lxml](https://www.crummy.com/software/BeautifulSoup/bs4/doc/#installing-a-parser) library (pip install lxml)
- python [jsonschema](https://python-jsonschema.readthedocs.io/en/stable/) library (pip install jsonschema)



Examples:

settings.json
```json
{
    "urlKMZ": "https://fsapps.nwcg.gov/data/kml/conus_lg_incidents.kmz",
    "urlOneVizion": "https://test.onevizion.com/",
    "ovAccessKey": "******",
    "ovSecretKey": "******",
    "importName": "Fires Default Data Import",
    "importAction": "INSERT"
}
```

file.csv
```csv
RegistrationID,Name,FireSize,FireType,Latitude,Longitude,Description
Fires-08/03/21,ALDER CREEK,9055,Wildfire,45.790,-113.101,<b>Report Date:</b> 07/09/2021<br/> <b>Latitude:</b> 45.790<br/> <b>Longitude:</b> -113.101<br/> <b>Fire Location:</b> N/A<br/> <b>Fire Size:</b> 9055 acres (3664.4 ha)<br/> <b>Percent Contained:</b> 10% <br/> <b>Expected Containment:</b> 11/1/2021<br/> <b>Fire Type:</b> Wildfire<br/> <b>Team Type:</b> Incident Management Team - Type 1<br/> See http://www.nifc.gov/news/sitreprt.pdf for more information
```

file.kml
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<kml xmlns="http://earth.google.com/kml/2.1">
  <Document>
    <description><![CDATA[ This KML displays the following: <br /> 1) Location of current large wildland fire incidents (>100 acres in timber; >300 acres in grasslands/shrublands) and associated incident information as provided by the National Interagency Coordination Center (NICC) at the National Interagency Fire Center (NIFC).<br />  <br /> Data current as of <b> 03-Aug-2021; 500 Mountain Time (03-Aug-2021; 1100 UTC)</b>.  KML file generated by the USDA Forest Service MODIS Active Fire Mapping Program.  Please see <a href="https://fsapps.nwcg.gov/afm"> https://fsapps.nwcg.gov/afm </a> for additional fire mapping products and information. <br />]]></description>
    <Folder>
      <Placemark>
        <name>ALDER CREEK</name>
        <description> <![CDATA[ <b>Report Date:</b> 07/09/2021<br/> <b>Latitude:</b> 45.790<br/> <b>Longitude:</b> -113.101<br/> <b>Fire Location:</b> N/A<br/> <b>Fire Size:</b> 9055 acres (3664.4 ha)<br/> <b>Percent Contained:</b> Unknown <br/> <b>Expected Containment:</b> Not Reported<br/> <b>Fire Type:</b> Other<br/> <b>Team Type:</b> Incident Management Team - Type 1<br/> See http://www.nifc.gov/news/sitreprt.pdf for more information  ]]></description>
        <Point>
          <coordinates>-113.101,45.790,0</coordinates>
        </Point>
        </Placemark>
        <Placemark>
          ...
        </Placemark>
    </Folder>
  </Document>
</kml>
```